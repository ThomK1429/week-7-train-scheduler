<!DOCTYPE html>

    <!-- Tom Keel 2016 06 19 - Week 7 - Train Scheduler  -  Local Storage -->

<html>

<head>
    <title>Week 7 - Train Scheduler</title>

    <!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <script src='https://code.jquery.com/jquery-2.1.3.min.js'>    </script>
    <link href="assets/css/style.css" rel="stylesheet" type="text/css">

    <!-- Link to Moment.js should go here -->
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    

    <!--<script src="assets/javascript/app.js" type="text/javascript">   </script>-->

    <!-- <style type="text/css">    </style>  -->
	<style type="text/css">    

	.jumbotron{
		background-color: rgb(127,70,40);
		color: rgb(238,238,238);
		border-radius: 10px;
    margin-top: -30px;
    margin-bottom: -40px;
	}

h1 {
  margin-top: -15px;
    margin-bottom: -5px;
  }


	#rrSign {
		height: 50px;
		width: 50px;
	}

  .panel-heading {
    background-color: rgb(51,122,183) !important;
  }
  .panel-title {
    color: white;
  }


  table, th, td {
    border-bottom: 1px solid lightblue;
    border-collapse: collapse;
}


	</style>


</head>


<body>

    <div class="jumbotron">
      <!-- <div id="theTime"></div> -->
      <div class="container text-center">
      	<img src="assets/images/rr_crossing_v2.jpg" id="rrSign">
      	<h1>The Marrakesh Express</h1>
      	<p>All on board the train...  All on board the train...  All on board... CSN railway</p>
      </div>

     </div>


    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Current Train Schedule</h3>
      </div>

      <div class="panel-body">
        
        <table id="tblHdr" width=100%>
          <thead>
            <tr>
             <th>Train <br /> Name</th>
             <th>Destination</th>
             <th>1st Train <br />Time</th>
             <th>Frequency (min)</th>
             <th>Next <br /> Arrival</th>
             <th>Minutes <br /> Away</th>
            </tr>
          </thead>
          <tbody> </tbody>
          </table>
        
      </div>
    </div>


<div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Add Train</h3>
      </div>

      <div class="panel-body">
      <form>
        <div class="form-group">
          <label for="inpTrainName">Train Name</label>
          <input type="text" class="form-control" id="inpTrainName" placeholder="">
        </div>
        <div class="form-group">
          <label for="inpDest">Destination</label>
          <input type="text" class="form-control" id="inpDest" placeholder="">
        </div>
        <div class="form-group">
          <label for="inpTrainTime">First Train Time (HH:mm - military time)</label>
          <input type="time" class="form-control" id="inpTrainTime" placeholder="">
        </div>
        <div class="form-group">
          <label for="inpFreq">Frequency (min)</label> 
          <input type="number"  class="form-control" id="inpFreq" placeholder="mm">
        </div>
        
        <button type="submit" class="btn btn-primary" id="submitBtn">Submit</button>
      </form>
      </div>

</div>

<script>



    $(document).ready(function() {
        console.log( "ready!" );

        if (localStorage.getItem("trainName") !== null) {

          var trainName = localStorage.getItem("trainName"); 
          var dest      = localStorage.getItem("dest");
          var trainTime = localStorage.getItem("trainTime");
          var freq      = localStorage.getItem("freq");

           var nextArrival = "a"; 
           var minutesAway = "4"; 
           var theTime = moment(currentTime).format("hh:mm");
           $("#theTime").append(theTime);



// Assumptions
    var tFrequency = freq;
    // var tFrequency = 60;
    //var firstTime = "03:30"; // Time is 3:30 AM
    var firstTime = trainTime; 

    // First Time (pushed back 1 year to make sure it comes before current time)
    var firstTimeConverted = moment(firstTime,"hh:mm").subtract(1, "years");
    console.log(firstTimeConverted);

    // Current Time
    var currentTime = moment();
    console.log("CURRENT TIME: " + moment(currentTime).format("hh:mm"));

    // Difference between the times
    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
    console.log("DIFFERENCE IN TIME: " + diffTime);

    // Time apart (remainder)
    var tRemainder = diffTime % tFrequency;
    console.log(tRemainder);

    // Minute Until Train
    var tMinutesTillTrain = tFrequency - tRemainder;
    console.log("MINUTES TILL TRAIN: " + tMinutesTillTrain);

    // Next Train
    var nextTrain = moment().add(tMinutesTillTrain, "minutes")
    console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm"))

    nextArrival = moment(nextTrain).format("hh:mm");
    minutesAway = tMinutesTillTrain;





        //  $("#employeeTable > tbody").append("<tr><td>" + empName + "</td><td>" + empRole + "</td><td>" + empStartPretty + "</td><td>" + empMonths + "</td><td>" + empRate + "</td><td>" + empBilled + "</td></tr>");

        $("#tblHdr > tbody").append("<tr><td>" + trainName + "</td><td>" 
                + dest + "</td><td>" + trainTime + "</td><td>" + freq + "</td><td>" + nextArrival + "</td><td>" 
                + minutesAway + "</td> </tr>");


          
          //alert(trainName + dest + freq + trainTime);
        } else alert("test - no data");


        $('#submitBtn').on('click', function() {

          var trainName = $('#inpTrainName').val().trim(); 
          localStorage.trainName = trainName;
          //console.log("trainName=" + trainName);  

          var dest = $('#inpDest').val().trim();
          localStorage.dest = dest; 

          var freq = $('#inpFreq').val().trim(); 
          localStorage.freq = freq;

          var trainTime = $('#inpTrainTime').val().trim(); 
          localStorage.trainTime = trainTime;

        });  // end submit btn on click function

    }); // end document.ready function


 

</script>


</body>
</html>